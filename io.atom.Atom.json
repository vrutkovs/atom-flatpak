{
    "app-id": "io.atom.Atom",
    "runtime": "org.freedesktop.Sdk",
    "runtime-version": "1.6",
    "base": "org.electronjs.Electron2.BaseApp",
    "base-version": "stable",
    "sdk": "org.freedesktop.Sdk",
    "command": "atom-beta",
    "rename-desktop-file": "atom-beta.desktop",
    "separate-locales": false,
    "finish-args": [
        "--share=ipc", "--socket=x11",
        "--socket=pulseaudio",
        "--share=network",
        "--device=dri",
        "--filesystem=host",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.freedesktop.secrets",
        "--talk-name=org.gtk.vfs",
        "--talk-name=org.gtk.vfs.*",
        "--env=ELECTRON_TRASH=gio",
        "--env=LD_LIBRARY_PATH=/app/lib"
      ],
    "modules": [
      {
        "name": "atom",
        "buildsystem": "simple",
        "build-commands": [
          "mkdir -p /app/share/icons/hicolor",
          "env GIT_SSL_NO_VERIFY=1 XDG_DATA_DIRS=/app/share ./script/build --install=/app",
          "install -Dm644 io.atom.Atom.appdata.xml /app/share/appdata/io.atom.Atom.appdata.xml",
          "install -Dm644 resources/app-icons/beta/png/1024.png /app/share/icons/hicolor/1024x1024/apps/io.atom.Atom.png",
          "install -Dm644 resources/app-icons/beta/png/512.png /app/share/icons/hicolor/512x512/apps/io.atom.Atom.png",
          "install -Dm644 resources/app-icons/beta/png/256.png /app/share/icons/hicolor/256x256/apps/io.atom.Atom.png",
          "install -Dm644 resources/app-icons/beta/png/128.png /app/share/icons/hicolor/128x128/apps/io.atom.Atom.png",
          "install -Dm644 resources/app-icons/beta/png/64.png /app/share/icons/hicolor/64x64/apps/io.atom.Atom.png",
          "install -Dm644 resources/app-icons/beta/png/32.png /app/share/icons/hicolor/32x32/apps/io.atom.Atom.png",
          "desktop-file-edit --set-icon=io.atom.Atom /app/share/applications/atom-beta.desktop",
          "desktop-file-edit --set-key=Exec --set-value='atom-beta %F' /app/share/applications/atom-beta.desktop",
          "install -m755 atom-beta /app/bin/atom-beta"
        ],
        "build-options": {
          "build-args": [
            "--share=network"
          ]
        },
        "sources": [
          {
            "type": "archive",
            "url": "https://github.com/atom/atom/archive/v1.30.0-beta1.tar.gz",
            "sha256": "80e08908cbe7f563dd42d4fc09e1eaa6f2a3d59a8294150c51b6cd223a47d2e8"
          },
          {
            "type": "file",
            "path": "io.atom.Atom.appdata.xml"
          },
          {
            "type": "script",
            "dest-filename": "atom-beta",
            "commands": [
              "exec env ATOM_HOME=\"$XDG_DATA_HOME\" /app/share/atom-beta/atom \"$@\""
            ]
          }
        ],
        "modules": [
          {
              "name": "libcurl-gnutls",
              "config-opts": [
                  "--disable-ldap",
                  "--disable-manual",
                  "--disable-ldaps",
                  "--enable-ipv6",
                  "--enable-threaded-resolver",
                  "--with-gnutls=/usr",
                  "--with-ca-bundle='/etc/ssl/certs/ca-certificates.crt'",
                  "--without-gssapi",
                  "--without-libidn",
                  "--without-ssl"
              ],
              "cleanup": [
                  "/bin"
              ],
              "post-install": [
                  "mv /app/lib/libcurl{,-gnutls}.so.4.5.0",
                  "rm /app/lib/libcurl.so*",
                  "ln -s /app/lib/libcurl-gnutls.so.4.5.0 /app/lib/libcurl-gnutls.so.4"
              ],
              "sources": [
                  {
                      "type": "archive",
                      "url": "https://curl.haxx.se/download/curl-7.59.0.tar.gz",
                      "sha256": "099d9c32dc7b8958ca592597c9fabccdf4c08cfb7c114ff1afbbc4c6f13c9e9e"
                  }
              ]
          },
          {
            "name": "gyp",
            "buildsystem": "simple",
            "cleanup": [ "*" ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://chromium.googlesource.com/external/gyp",
                    "commit": "324dd166b7c0b39d513026fa52d6280ac6d56770"
                }
            ],
            "build-commands": [
                "python2 setup.py install --prefix=/app"
            ]
          },
          {
            "name": "nss",
            "buildsystem": "simple",
            "subdir": "nss",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ftp.mozilla.org/pub/security/nss/releases/NSS_3_32_RTM/src/nss-3.32.tar.gz",
                    "sha256": "35c6f381cc96bb25e4f924469f6ba3e57b3a16e0c2fb7e295a284a00d57ed335"
                },
                {
                    "type": "patch",
                    "path": "gyp-no-parallel.patch"
                }
            ],
            "build-commands": [
                "./build.sh --system-sqlite --system-nspr --enable-libpkix -v -o",
                "install -D ../dist/Release/lib/*.so /app/lib"
            ]
        },
        {
            "name": "libsecret",
            "config-opts": [
                "--disable-manpages",
                "--disable-gtk-doc",
                "--disable-static",
                "--disable-introspection"
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/pkgconfig",
                "/share/gtk-doc",
                "*.la"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.gnome.org/pub/GNOME/sources/libsecret/0.18/libsecret-0.18.5.tar.xz",
                    "sha256": "9ce7bd8dd5831f2786c935d82638ac428fa085057cc6780aba0e39375887ccb3"
                },
                {
                    "type": "shell",
                    "commands": ["autoreconf -f"]
                }
            ]
        },
        {
            "name": "nodejs",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://nodejs.org/dist/v8.9.0/node-v8.9.0.tar.xz",
                    "path": "node.tar.xz",
                    "sha256": "ae8258f89e127a76d4b4aff6fdb8dc395b7da0069cba054b913dfc36b3c91189"
                }
            ]
        },
        {
            "name": "xkbfile",
            "cleanup": ["/include", "/lib/*.la", "/lib/pkgconfig"],
            "config-opts": ["--disable-static"],
            "sources": [
              {
                "type": "archive",
                "url": "https://www.x.org/releases/individual/lib/libxkbfile-1.0.9.tar.bz2",
                "sha256": "51817e0530961975d9513b773960b4edd275f7d5c72293d5a151ed4f42aeb16a"
              }
            ]
          }
        ]
      },
      {
        "name": "pyls",
        "buildsystem": "simple",
        "build-commands": [
          "python3 setup.py install --prefix=/app"
        ],
        "build-options": {
          "build-args": [
            "--share=network"
          ]
        },
        "sources": [
          {
            "type": "archive",
            "url": "https://github.com/palantir/python-language-server/archive/0.19.0.tar.gz",
            "sha256": "5bd07b4c6224622517862dfe704d2015ccfa53fe091e13a40421687dc24a8acc"
          }
        ]
      }
    ]
  }
